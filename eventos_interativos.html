<!DOCTYPE html>
isShort: ev.duration < 60
});
t = (Math.floor(t/60)+1)*60; // vai pra próxima hora cheia
t %= 1440;
} while (startMin < endMin ? (t < endMin && t > startMin) : (t < endMin || t > startMin));
});
});
return matrix;
}


// ---------- RENDER ----------
const matrix = buildMatrix();
const tbody = document.getElementById('agenda-body');


HORAS.forEach(h => {
const tr = document.createElement('tr');
const th = document.createElement('th');
th.textContent = h; tr.appendChild(th);


DIAS.forEach(dia => {
const td = document.createElement('td'); td.className='cell';
const wrap = document.createElement('div'); wrap.className='chips';
const list = matrix[h][dia] || [];
list.forEach((item, idx) => {
const chip = document.createElement('span'); chip.className='chip';
chip.style.setProperty('--c', COLORS[item.name] || '#6bcfff');
chip.textContent = item.name + (item.isShort ? ` (⏱️ ${item.duration}m)` : '');
wrap.appendChild(chip);
if(idx < list.length-1){ const sep=document.createElement('span'); sep.className='sep'; sep.textContent='|'; wrap.appendChild(sep); }
});
td.appendChild(wrap);
tr.appendChild(td);
});


tbody.appendChild(tr);
});


// Cria legenda de cores
const legend = document.getElementById('legend');
Object.entries(COLORS).forEach(([name,color])=>{
const li = document.createElement('div'); li.className='legend-item';
li.innerHTML = `<span class="legend-swatch" style="background:${color}"></span> ${name}`;
legend.appendChild(li);
});


// ---------- RELÓGIO + DESTAQUES + PROGRESSO ----------
function updateNow(){
const now = new Date();
document.getElementById('clock').textContent = now.toLocaleTimeString('pt-BR');


// Destacar linha da hora atual (considerando a ordem que inicia às 14:00)
const hr = now.getHours();
const currentSlot = pad2(hr)+":00";
const rowIndex = HORAS.indexOf(currentSlot);
document.querySelectorAll('#agenda tbody tr').forEach(tr=>tr.classList.remove('row-highlight'));
if(rowIndex>=0){ document.querySelectorAll('#agenda tbody tr')[rowIndex].classList.add('row-highlight'); }


// Destacar dia atual no cabeçalho
const dowIdx = (now.getDay() + 6) % 7; // segunda=0 ... domingo=6
DIAS.forEach((d,i)=> document.getElementById('h-'+d).classList.toggle('day-highlight', i===dowIdx));


// Barra de progresso por célula do dia atual
// Remove barras antigas
document.querySelectorAll('.progress').forEach(p=>p.remove());
if(rowIndex>=0){
const row = document.querySelectorAll('#agenda tbody tr')[rowIndex];
const cell = row.children[dowIdx+1]; // +1 por causa da coluna Horário
const textCombined = (cell.textContent||'').toLowerCase();
if(textCombined.trim()){ // existe algo no horário
// Decidir duração do evento do dia atual neste slot:
// Se houver vários, pega a maior duração que cobre o slot (melhor feedback visual)
const items = (matrix[currentSlot][DIAS[dowIdx]]||[]);
let dur = 60; // default slot
if(items.length){ dur = Math.max(...items.map(i=>i.duration)); }
const mins = now.getMinutes();
const pct = Math.min(100, (mins / dur) * 100);
const bar = document.createElement('div'); bar.className='progress';
const inner = document.createElement('div'); inner.className='bar'; inner.style.width = pct+"%";
bar.appendChild(inner); cell.appendChild(bar);
}
}
}


updateNow();
setInterval(updateNow, 1000);
</script>
</body>
</html>
